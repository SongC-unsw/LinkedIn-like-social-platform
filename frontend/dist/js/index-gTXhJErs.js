import{M as e}from"./vendor-DP3_akjZ.js";function t(e){if(!["image/jpeg","image/png","image/jpg"].find(t=>t===e.type))throw Error("provided file is not a png, jpg or jpeg image.");const t=new FileReader,n=new Promise((e,n)=>{t.onerror=n,t.onload=()=>e(t.result)});return t.readAsDataURL(e),n}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}(),window.imageObservers=new Set;const n=(e,t,n=null)=>{if(!t)return;let s=null,o=e;if(n){const t=e.style.width||"100%",i=e.style.height||"auto";s=((e,t)=>{const n=document.createElement("div");return n.className="image-placeholder",n.style.width=e,n.style.height=t,n.style.backgroundColor="#e9ecef",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.color="#6c757d",n.style.fontSize="14px",n.innerHTML='<div class="spinner-border spinner-border-sm" role="status"></div>',n})(t,i),e.className.includes("rounded-circle")&&(s.style.borderRadius="50%"),n.insertBefore(s,e),e.style.opacity="0",e.style.position="absolute",e.style.visibility="hidden",o=s}else e.style.opacity="0";const i=new IntersectionObserver(n=>{n.forEach(n=>{n.isIntersecting&&(((e,t,n=null)=>{if(!t)return;const s=new Image;s.onload=()=>{e.src=t,e.style.position="",e.style.visibility="",e.style.opacity="0",e.style.transition="opacity 0.3s ease",n&&n.parentNode&&n.parentNode.removeChild(n),setTimeout(()=>{e.style.opacity="1"},10)},s.onerror=()=>{e.style.position="",e.style.visibility="",e.style.opacity="1",n&&n.parentNode&&n.parentNode.removeChild(n)},s.src=t})(e,t,s),i.unobserve(o),window.imageObservers.delete(i))})},{rootMargin:"50px"});window.imageObservers.add(i),i.observe(o)},s=e=>{window.scrollListener&&(window.removeEventListener("scroll",window.scrollListener),window.scrollListener=null),window.imageObservers.forEach(e=>{e.disconnect()}),window.imageObservers.clear();const t=document.querySelectorAll(".page");for(const n of t)n.classList.add("hide");document.querySelector(`.${e}.page`).classList.remove("hide")},o=(e,t,n)=>{const s=localStorage.getItem("token");return fetch("https://ass3-backend-production.up.railway.app/"+e,{method:n,headers:{"Content-type":"application/json",Authorization:s?`Bearer ${s}`:void 0},body:"GET"===n?void 0:JSON.stringify(t)}).then(e=>e.json()).then(e=>{if(!e.error)return Promise.resolve(e);p(e.error)})},i=(e,t)=>o(`job/feed/?start=${t}`,{},"GET").then(n=>{if(window.currentIndex=t,0===t){const t=document.querySelector(e);for(;t.firstChild;)t.removeChild(t.firstChild);r(e)}n.sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt));const s=document.querySelector(e),o=document.createDocumentFragment();return Promise.all(n.map(e=>c(e))).then(e=>(e.forEach(e=>{o.appendChild(e)}),s.appendChild(o),window.isLoading=!1,n.length))}),r=e=>{window.currentIndex=0,window.isLoading=!1,window.noMorePosts=!1,window.scrollListener=()=>{if(window.isLoading||window.noMorePosts)return;const t=window.scrollY+window.innerHeight;if(document.documentElement.scrollHeight-t<30){window.isLoading=!0;const t=document.querySelector(".loading");t&&t.classList.remove("d-none"),i(e,window.currentIndex+5).then(e=>{0===e&&(window.noMorePosts=!0,t&&t.classList.add("d-none"))}).catch(e=>{window.isLoading=!1,t&&t.classList.add("d-none")})}},window.addEventListener("scroll",window.scrollListener)},d=e=>{const t=document.querySelector(".job-posted-container");for(;t.firstChild;)t.removeChild(t.firstChild);if(!e.jobs||0===e.jobs.length){const e=document.createElement("div");return e.className="alert alert-info text-center",e.innerText="No jobs posted yet",t.appendChild(e),Promise.resolve()}const n=e.jobs;n.sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt));const s=document.createDocumentFragment();return Promise.all(n.map(e=>c(e))).then(e=>(e.forEach(e=>{s.appendChild(e)}),t.appendChild(s),e.length))},l=(e,t)=>{t?(e.classList.remove("btn-primary"),e.classList.add("btn-success")):(e.classList.remove("btn-success"),e.classList.add("btn-primary"))},a=e=>{const t=document.createElement("div");return t.classList.add("comment-item","d-flex","mb-2","pb-2","border-bottom"),o(`user?userId=${e.userId}`,{},"GET").then(o=>{const i=o.image,r=document.createElement("div");r.classList.add("comment-avatar","me-2");const d=document.createElement("div");if(d.className="rounded-circle bg-secondary text-white d-flex justify-content-center align-items-center",d.style.width="32px",d.style.height="32px",d.style.fontSize="14px",i){const e=document.createElement("img");e.className="user-comment-image rounded-circle",e.alt="user-profile-img",e.style.width="32px",e.style.height="32px",d.appendChild(e),n(e,i,d)}else d.textContent=e.userName?e.userName.charAt(0):"U";r.appendChild(d);const l=document.createElement("div");l.classList.add("comment-content","flex-grow-1");const a=document.createElement("div");a.classList.add("comment-user","fw-bold","small"),a.innerText=e.userName,a.style.cursor="pointer",a.addEventListener("click",()=>{m(o),s("profile")});const c=document.createElement("div");return c.classList.add("comment-text","small","text-break","text-wrap"),c.innerText=e.comment,l.appendChild(a),l.appendChild(c),t.appendChild(r),t.appendChild(l),t})},c=e=>{const i=document.createElement("div");i.className="feed-post bg-white mb-3 shadow-sm p-4",i.id=`post-${e.id}`,i.classList.add("d-flex","flex-column");const r=document.createElement("div");r.className="post-top-section",r.style.display="flex",r.style.alignItems="center";const d=document.createElement("div");return d.className="post-header",o(`user?userId=${e.creatorId}`,{},"GET").then(c=>o(`user?userId=${localStorage.getItem("userId")}`,{},"GET").then(u=>{const h=u.name,y=c.name,f=document.createElement("div"),v=document.createElement("button"),b=document.createElement("button");f.append(b,v),f.classList.add("ms-auto"),v.className="btn btn-light d-none",b.className="btn btn-light d-none",b.innerText="âœï¸ Edit Post",v.innerText="ðŸ—‘ï¸ Delete",e.creatorId===parseInt(localStorage.getItem("userId"))&&(b.classList.remove("d-none"),v.classList.remove("d-none")),v.addEventListener("click",()=>{o("job",{id:e.id},"DELETE").then(()=>{i.remove()})}),b.addEventListener("click",()=>{document.getElementById("job-title").value=e.title,document.getElementById("job-text").textContent=e.description;const t=document.getElementById("dateInput"),n=new Date(e.start).toLocaleDateString("en-CA",{timeZone:"Australia/Sydney"});t.value=n;const s=document.querySelector(".current-image-display");e.image&&(s.src=e.image),g();const i=document.querySelector(".save-job-edit");i.addEventListener("click",()=>{const t=document.getElementById("job-title").value,n=document.getElementById("job-text").value,r=new Date(document.getElementById("dateInput").value),d=s.src;o("job",{id:e.id,title:t,description:n,start:r,image:d},"PUT").then(()=>{i.classList.remove("btn-primary"),i.classList.add("btn-success"),i.innerText="Saved!",setTimeout(()=>{i.classList.remove("btn-success"),i.classList.add("btn-primary"),i.innerText="Save Changes"},800)})})});const E=document.getElementById("job-image-upload"),w=document.querySelector(".current-image-display");E.addEventListener("change",e=>{const n=e.target.files[0];n&&t(n).then(e=>{w.src=e}).catch(e=>{p("Failed to process the image")})});const L=document.createElement("div");if(L.className="profile-picture rounded-circle bg-secondary text-white d-flex justify-content-center align-items-center",L.style.width="50px",L.style.height="50px",L.style.fontSize="1.3rem",c.image){const e=document.createElement("img");e.className="profile-image",e.alt="Profile Picture",e.style.width="50px",e.style.height="50px",L.classList.remove("bg-secondary"),e.classList.add("rounded-circle"),L.appendChild(e),n(e,c.image,L)}else L.textContent=y?y.charAt(0):"U";const x=document.createElement("div");x.style.width="50px",x.style.flexShrink="0",x.appendChild(L),r.appendChild(x);const I=document.createElement("div");I.className="author-name fw-bold",I.innerText=y,I.style.cursor="pointer",I.style.fontSize="1.3rem",I.addEventListener("click",()=>{m(c),s("profile")});const C=document.createElement("div");C.className="post-time",C.classList.add("text-secondary"),C.style.fontSize="0.8rem";const S=new Date,T=new Date(e.createdAt);if(S-T>864e5){const e=T.getFullYear(),t=String(T.getDate()).padStart(2,"0"),n=String(T.getMonth()+1).padStart(2,"0");C.innerText=`Posted on ${t}/${n}/${e}`}else{const e=S-T,t=Math.floor(e/6e4),n=Math.floor(t/60),s=t%60;C.innerText=`Posted ${n} ${n>1?"hours":"hour"} and ${s} ${s>1?"minutes":"minute"} ago`}d.style.display="flex",d.style.flexDirection="column",r.style.display="flex",d.classList.add("ms-3"),r.classList.add("mb-3"),d.appendChild(I),d.appendChild(C),r.appendChild(d),r.appendChild(f),i.appendChild(r);const k=document.createElement("div"),N=document.createElement("h4"),j=document.createElement("p"),B=document.createElement("img"),P=new Date(e.start).toLocaleDateString("en-GB"),$=document.createElement("div");k.append(N,$,j),k.className="post-content",k.style.width="100%",N.className="post-title",N.innerText=e.title,j.className="post-job-detail",j.innerText=e.description,e.image&&(B.classList.add("img-fluid","img-thumbnail"),B.style.width="100%",k.appendChild(B),n(B,e.image,null)),i.appendChild(k),$.classList.add("start-time","bg-info","bg-opacity-10","px-3","py-2","my-2","rounded-pill","text-primary","fw-bold","d-inline-block"),$.innerText=`Start Date: ${P}`;const q=document.createElement("div");q.classList.add("container","d-flex","justify-content-between","align-items-center","mt-3","px-2");const D=document.createElement("button"),A=e.likes.length;D.innerText=`ðŸ‘ ${A>0?A:""}`,D.type="button",D.classList.add("btn","btn-primary");const O=document.createElement("div");O.className="like-by",O.classList.add("text-muted","small","mt-3","mb-2","d-block");let M=!1,G=[];G=e.likes.map(e=>e.userName);for(const t of e.likes)if(String(t.userId)===localStorage.getItem("userId")){M=!0;break}O.innerText=G.length>0?`Liked by: ${G.join(", ")}`:"No likes yet",l(D,M),((e,t,n,s,i)=>{let r=n.likes.length,d=n.likes.map(e=>e.userName);e.addEventListener("click",()=>{l(e,i=!i),i?d.includes(s)||d.unshift(s):d=d.filter(e=>e!==s),t.innerText=d.length>0?`Liked by: ${d.join(", ")}`:"No likes yet",r=i?r+1:r-1,e.innerText=`ðŸ‘ ${r>0?r:""}`,o("job/like",{id:n.id,turnon:i},"PUT")})})(D,O,e,h,M);const U=document.createElement("button"),W=e.comments.length;U.innerText=`ðŸ’¬ ${W>0?W:""}`,U.classList.add("btn","btn-primary");const F=document.createElement("div");F.classList.add("comment-section","container","bg-light","p-3","mt-2","rounded","hide");const z=document.createElement("div");if(z.classList.add("comments-list"),0===e.comments.length){const e=document.createElement("p");e.classList.add("text-muted","small","fst-italic"),e.innerText="No comments yet",F.appendChild(e)}e.comments.length>0&&Promise.all(e.comments.map(e=>a(e))).then(e=>{e.forEach(e=>{z.appendChild(e)})}),F.appendChild(z);const H=document.createElement("div");H.classList.add("comment-form","mt-3","d-flex");const R=document.createElement("input");R.type="text",R.required=!0,R.classList.add("form-control","form-control-sm","me-2"),R.placeholder="Add a comment...";const Y=document.createElement("button");return Y.classList.add("btn","btn-sm","btn-primary"),Y.innerText="Post",((e,t,n,s,i,r)=>{e.addEventListener("click",()=>{if(t.value){const e={userId:localStorage.getItem("userId"),userName:n,comment:t.value};a(e).then(e=>{s.appendChild(e),i.innerText=`ðŸ’¬ ${parseInt(i.innerText.replace(/[^0-9]/g,"")||0)+1}`,o("job/comment",{id:r.id,comment:t.value},"POST"),t.value=""})}})})(Y,R,h,z,U,e),H.appendChild(R),H.appendChild(Y),F.appendChild(H),U.addEventListener("click",()=>{F.classList.toggle("hide")}),q.append(D,U),i.appendChild(q),i.appendChild(O),i.appendChild(F),i}))},m=e=>{const t=document.querySelector(".profile-page-pic"),i=document.querySelector(".profile-page-username"),r=document.querySelector(".profile-email-value"),l=document.querySelector(".profile-watch-count"),a=document.querySelector(".followed-by-name"),c=e.usersWhoWatchMeUserIds;let m=[];return Promise.all(c.map(e=>o(`user?userId=${e}`,{},"GET"))).then(p=>{m=p.filter(e=>e&&e.name).map(e=>e.name),a.innerText=m.join(", "),r.innerText=e.email,l.innerText=c.length,t.replaceChildren(),i.innerText=e.name;const g=document.createElement("div");if(t.appendChild(g),g.className="profile-avatar-container rounded-circle bg-secondary fs-3 text-white d-flex justify-content-center align-items-center",g.style.width="70px",g.style.height="70px",e.image){const t=document.createElement("img");t.className="profile-image",t.alt="Profile Picture",t.style.width="70px",t.style.height="70px",g.classList.remove("bg-secondary"),t.classList.add("rounded-circle"),g.appendChild(t),n(t,e.image,g)}else g.textContent=e.name?e.name.charAt(0):"U";const h=document.querySelector(".profile-follow-btn-container");for(;h.firstChild;)h.removeChild(h.firstChild);if(h){const t=parseInt(localStorage.getItem("userId"));return o(`user?userId=${t}`,{},"GET").then(n=>{const i=n.name;if(e.id!==t){const n=document.createElement("button");n.className="btn btn-primary";let s=e.usersWhoWatchMeUserIds.includes(t);u(n,s),n.addEventListener("click",()=>{s=!s,u(n,s),o("user/watch",{email:e.email,turnon:s},"PUT").then(()=>o(`user?userId=${e.id}`,{},"GET")).then(e=>{l.innerText=e.usersWhoWatchMeUserIds.length,s?m.includes(i)||m.unshift(i):m=m.filter(e=>e!==i),a.innerText=m.join(", ")})}),h.appendChild(n)}else{for(;h.firstChild;)h.removeChild(h.firstChild);const e=document.createElement("button");h.appendChild(e),e.className="update-profile-btn btn btn-outline-dark",e.innerText="ðŸ“ Edit your profile",e.addEventListener("click",()=>{L(),s("profile-edit")})}return d(e)})}return d(e)})},u=(e,t)=>{t?(e.innerText="ðŸ‘€ Watching Now",e.classList.remove("btn-primary"),e.classList.add("btn-success")):(e.innerText="ðŸ‘€ Watch",e.classList.remove("btn-success"),e.classList.add("btn-primary"))};localStorage.getItem("token")?(s("home"),i(".feed",0)):s("login");const p=t=>{const n=document.getElementById("popup");n.querySelector(".modal-body p").textContent=t,new e(n).show()},g=()=>{const t=document.getElementById("edit-post-popup");new e(t).show()};document.getElementById("submit").addEventListener("click",()=>{const e=document.getElementById("email").value,t=document.getElementById("name").value,n=document.getElementById("password").value,r={email:e,name:t,password:n};document.getElementById("confirmPassword").value!==n?p("Password doesn't match"):o("auth/register",r,"POST").then(e=>{localStorage.setItem("token",e.token),localStorage.setItem("userId",e.userId),s("home"),i(".feed",0),v()})}),document.getElementById("login").addEventListener("click",e=>{e.preventDefault();const t=document.getElementById("email-login").value,n=document.getElementById("password-login").value;o("auth/login",{email:t,password:n},"POST").then(e=>{localStorage.setItem("token",e.token),localStorage.setItem("userId",e.userId),s("home"),i(".feed",0),v()})}),document.getElementById("login-link").addEventListener("click",()=>{s("login")}),document.getElementById("signup-link").addEventListener("click",()=>{s("registration")});const h=document.getElementsByClassName("logout-btn");for(const k of h)k.addEventListener("click",()=>{localStorage.clear(),s("login")});const y=document.getElementsByClassName("home-page-button");for(const k of y)k.addEventListener("click",()=>{s("home")});const f=()=>o(`user?userId=${localStorage.getItem("userId")}`,{},"GET"),v=()=>{const e=document.getElementsByClassName("current-user-name");return f().then(t=>{for(const n of e)n.classList.add("me-2"),n.style.cursor="pointer",n.innerText=`Logged In As: ${t.name}`,n.addEventListener("click",()=>{o(`user?userId=${localStorage.getItem("userId")}`,{},"GET").then(e=>{m(e),s("profile")})})})},b=document.getElementById("edit-email"),E=document.getElementById("edit-name"),w=document.getElementById("edit-password"),L=()=>{const e=document.querySelector(".avatar-profile-edit");return f().then(t=>(e.src=t.image,b.value=t.email,E.value=t.name,w.value="",t))};localStorage.getItem("token")&&v();const x=document.getElementById("profile-image-upload"),I=document.getElementById("file-selected");let C;x.addEventListener("change",e=>{const n=e.target.files[0];n?(I.textContent=`Selected: ${n.name}`,t(n).then(e=>{C=e,document.querySelector(".avatar-profile-edit").src=C}).catch(e=>{p("Failed to process the image")})):(I.textContent="No file selected",C=void 0)});const S=document.getElementById("save-profile");S.addEventListener("click",e=>{e.preventDefault(),S.innerText="Saving...",S.disabled=!0,f().then(e=>{const t={email:e.email!==b.value?b.value:void 0,password:w.value?w.value:void 0,name:e.name!==E.value?E.value:void 0,image:e.image!==C?C:void 0};return o("user",t,"PUT")}).then(()=>{S.classList.remove("btn-primary"),S.innerText="Saved!",S.classList.add("btn-success"),setTimeout(()=>{S.innerText="Save Changes",S.classList.remove("btn-success"),S.classList.add("btn-primary"),S.disabled=!1},800)})}),document.querySelector(".create-job-post").addEventListener("click",()=>{(()=>{const t=document.getElementById("new-post-popup");new e(t).show()})(),T()}),document.querySelector(".post-job").addEventListener("click",function(){const t=document.getElementById("post-job-title"),n=document.getElementById("post-job-text"),s=document.getElementById("post-dateInput"),i=document.querySelector(".post-current-image-display"),r=t.value,d=n.value,l=new Date(s.value),a=i.classList.contains("d-none")?null:i.src;r&&d&&l&&!isNaN(l)?o("job",{title:r,image:a||"",start:l,description:d},"POST").then(()=>{this.classList.remove("btn-primary"),this.classList.add("btn-success"),this.innerText="Posted!",setTimeout(()=>{this.classList.remove("btn-success"),this.classList.add("btn-primary"),this.innerText="Post",t.value="",n.value="",s.value="",i.src="",i.classList.add("d-none");const o=document.getElementById("new-post-popup");e.getInstance(o).hide()},800)}):p("Please fill in all required fields")});const T=()=>{const e=document.getElementById("post-job-image-upload"),n=document.querySelector(".post-current-image-display");document.querySelector(".post-job"),e.addEventListener("change",e=>{const s=e.target.files[0];s&&t(s).then(e=>{n.src=e,n.classList.remove("d-none")}).catch(e=>{p("Failed to process the image")})})};
